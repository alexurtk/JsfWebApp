<?xml version="1.0" encoding="UTF-8"?>
<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"-->
        <!--"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">-->
<f:view xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>

</h:head>
<h:body>
    <h:form id="form">
        <p:dialog modal="true" widgetVar="statusDialog" header="Status" draggable="false" closable="false">
            Downloading...
        </p:dialog>
        <p:messages id="messages" autoUpdate="true" showDetail="false"/>
        <h:panelGrid columns="2">
            <h:outputText value="Login: "/>
            <h:inputText value="#{exampleCDI.login}" />

            <h:outputText value="Password: "/>
            <h:inputText value="#{exampleCDI.password}" />

            <h:outputText value="Action: "/>
            <h:commandLink value="Create" action="#{exampleCDI.createUser()}"/>
        </h:panelGrid>
        <br/>
        <p:growl id="msgs" showDetail="true" />
        <p:commandButton value="UpdateTable" actionListener="#{dtSelectionView.addCar()}" update="basicDT, tabSize"/>
        <p:commandButton value="Скачать"
                         onclick="PrimeFaces.monitorDownload(showStatus, hideStatus)"
                         ajax="false">
            <p:fileDownload value="#{dtSelectionView.streamFile()}"/>
        </p:commandButton>
        <p:remoteCommand name="stops" uactionListener="#{dtSelectionView.testEmpty}"/>
        <h:outputText id="tabSize" value="#{dtSelectionView.cars1.size()}"/>
        <br/>
        <p:commandButton value="TestServerUpdate1" actionListener="#{dtSelectionView.testBackUpdate1()}"/>
        <p:commandButton value="TestServerUpdate2" actionListener="#{dtSelectionView.testBackUpdate2()}"/>
        <p:commandButton value="TestServerUpdate3" actionListener="#{dtSelectionView.testBackUpdate3()}"/>
        <br/>
        <h:panelGrid columns="2">
            <h:outputText value="Телфон:"/>
            <p:inputMask mask="+7(999)999-99-99"
                         id="phoneNumber"
                         onkeyup="formatUniPhoneNumber()"
                         onmouseup="formatUniPhoneNumber()"
                         onmouseout="mouseout()"
                         value="#{dtSelectionView.mobilePhone}">
                <p:ajax event="change"
                        update="testPhoneButton"/>
            </p:inputMask>
            <p:remoteCommand name="remoteCheckPhone" immediate="true" actionListener="#{dtSelectionView.checkPhone()}"/>
            <p:remoteCommand name="remoteBlock" update="testPhoneButton" immediate="true" actionListener="#{dtSelectionView.block()}"/>
        </h:panelGrid>
        <p:commandButton value="TestPhoneButton"
                         id="testPhoneButton"
                         disabled="#{dtSelectionView.checkPhone()}"/>
        <p:commandButton value="TestServerUpdate3" actionListener="#{dtSelectionView.addCar()}"/>
        <p:dataTable id="basicDT" var="car" value="#{dtSelectionView.cars1}">
            <f:facet name="header">
                Basic
            </f:facet>
            <p:column headerText="Test">
                <p:graphicImage value="resources/images/previous_16.png"/>
            </p:column>
            <p:column headerText="Id">
                <h:outputText value="#{car.id}"/>
            </p:column>
            <p:column headerText="Year">
                <h:outputText value="#{car.year}"/>
            </p:column>
            <p:column headerText="Brand">
                <h:outputText value="#{car.brand}"/>
            </p:column>
            <p:column headerText="Color">
                <h:outputText value="#{car.color}"/>
            </p:column>
            <p:column style="width:32px;text-align: center">
                <p:commandButton oncomplete="test1()" icon="ui-icon-search" title="View" update="basicDT">
                    <f:setPropertyActionListener value="#{car}" target="#{dtSelectionView.selectedCar}"/>
                    <p:remoteCommand name="testt" actionListener="#{dtSelectionView.testt}"/>
                </p:commandButton>
            </p:column>
            <p:column headerText="Test">
                <p:fileUpload
                        id="upload"
                        fileUploadListener="#{dtSelectionView.uploadFile}"
                        update="@this"
                        mode="advanced"
                        multiple="false"
                        auto="true"
                        allowTypes="/(\.|\/)(jpg|png|txt)$/"
                        invalidFileMessage="incorrect file">
                    <f:attribute name="foo" value="#{car}"/>
                </p:fileUpload>
            </p:column>
        </p:dataTable>
        <p:dialog header="Car Info" widgetVar="carDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
            <p:outputPanel id="carDetail" style="text-align:center;">
                <p:panelGrid  columns="2" rendered="#{not empty dtSelectionView.selectedCar}" columnClasses="label,value">
                    <f:facet name="header">
                        <p:graphicImage name="demo/images/car/#{dtSelectionView.selectedCar.brand}-big.gif"/>
                    </f:facet>

                    <h:outputText value="Id:" />
                    <h:outputText value="#{dtSelectionView.selectedCar.id}" />

                    <h:outputText value="Year" />
                    <h:outputText value="#{dtSelectionView.selectedCar.year}" />

                    <h:outputText value="Color:" />
                    <h:outputText value="#{dtSelectionView.selectedCar.color}" style="color:#{dtSelectionView.selectedCar.color}"/>

                    <h:outputText value="Price" />
                    <h:outputText value="$#{dtSelectionView.selectedCar.price}" />
                </p:panelGrid>
            </p:outputPanel>
        </p:dialog>
    </h:form>
</h:body>
<script>
    function test1() {
        testt();
    }
    function showStatus() {
        PF('statusDialog').show();
    }
    function hideStatus() {
        PF('statusDialog').hide();
    }

    function mouseout() {
//        console.log($('[id$=phoneNumber]').val());
        checkValue($('[id$=phoneNumber]').val());
    }

    function formatUniPhoneNumber() {
//        console.log($('[id$=phoneNumber]').val());
        checkValue($('[id$=phoneNumber]').val());

        function formatUniPhoneNumber(){
            var data = e.originalEvent.clipboardData.getData('Text');
            if (data != null) {
                switch (data.charAt(0)) {
                    case '+': {
                        return data.substring(2, data.length);
                    }
                    case '8': {
                        return data.substring(1, data.length);
                    }
                    case '9': {
                        return data;
                    }
                    case '7': {
                        return data.substring(1, data.length);
                    }
                }
            }
        }

        $('[id$=phoneNumber]').bind('paste', function (e) {
            $('[id$=phoneNumber]').val(formatPhoneNumber(e));
        })
    }

    function checkValue(val) {
        if (val == "" || val == "+7(___)___-__-__"){
            console.log("block "+val);
            remoteBlock();
        }
    }





</script>

</f:view>