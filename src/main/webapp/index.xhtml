<?xml version="1.0" encoding="UTF-8"?>
<!--<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"-->
        <!--"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">-->
<f:view xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>WebApp</h:head>
<h:body>
    <p:panel header="Создание товара">
        <p:panelGrid columns="2">
            <p:column>
                <h:outputText value="Test1"/>
            </p:column>
            <p:column>
                <h:outputText value="Test2"/>
            </p:column>
        </p:panelGrid>


        <br/>
        <br/>
        <br/>

        <h:form id="form">
            <p:messages id="messages" autoUpdate="true" showDetail="false"/>
            <p:panelGrid columns="1">
                <!--size is integer variable-->
                <p:inputText id="size" maxlength="3"
                             value="#{exampleCDI.size}"
                             required="true" requiredMessage="Size is missing"
                             onchange="forceValidation();"/>


                <p:fileUpload
                        id="upload"
                        fileUploadListener="#{exampleCDI.uploadFile}"
                        multiple="false"
                        widgetVar="fileUploadWidget"
                        allowTypes="/(\.|\/)(jpg|png|txt)$/"
                        invalidFileMessage="incorrect file"/>
            </p:panelGrid>
            <p:remoteCommand name="startSomething" action="#{exampleCDI.startSomething()}"/>
            <p:remoteCommand name="rc" actionListener="#{exampleCDI.startSomething}" />
            <p:commandButton type="button" onclick="rc()" value="Execute"/>

        </h:form>
    </p:panel>
</h:body>
<script>
    var test = 0;

    function rc() {
        console.log("dsf");

        PF('fileUploadWidget').chooseButton.click();

    }

    var triggerValidation;
    window.onload = function () {
        //initially (after page is loaded) trigger validation on Choose btn click
        //define button click listener
        registerChooseBtnClick();
    };

    function registerChooseBtnClick() {
        console.log("lol1");
        //var chooseBtn = document.getElementsByClassName("ui-fileupload-choose")[0];
        // or if you define p:upload widgetVar you can use PF function
        var chooseBtn = PF('fileUploadWidget').chooseButton[0];
        chooseBtn.addEventListener('click', fnRef, false);
    }

    var fnRef = function (event) {
        console.log("Button clicked");

        event.preventDefault();
        event.stopPropagation();

//
//        if (test == 0) {
//
//
//            event.preventDefault();
//            event.stopPropagation();
//
//            console.log("123")
//
//
//            PF('fileUploadWidget').chooseButton.click();
//
//
//        }






        if (triggerValidation) {
            //prevent file browser to open

            //trigger validation via p:remoteCommand;
            //submitSelection();
        } else {
            //File browser will be opened at this point
        }
    };

    function checkIfValidationFailed(xhr, status, args) {
        if (args) {
            if (args.validationFailed) {
                console.log("Validation failed");
                triggerValidation = true;
            } else {
                triggerValidation = false;
            }
        }
    }

    //call each time when form input elements (inputText, ...) change value
    function forceValidation(){
        triggerValidation = true;
    }

</script>
</f:view>
